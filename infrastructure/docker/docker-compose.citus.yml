version: "3.8"

services:
    citus-coordinator:
        image: citusdata/citus:12.1.1
        container_name: talentsphere-citus-coordinator
        ports:
            - "5432:5432"
        environment:
            POSTGRES_USER: ${POSTGRES_USER:-talentsphere}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-securepassword}
            POSTGRES_DB: ${POSTGRES_DB:-talentsphere_db}
            PGDATA: /var/lib/postgresql/data
        volumes:
            - citus_coordinator_data:/var/lib/postgresql/data
        networks:
            - talentsphere-net
        healthcheck:
            test: ["CMD-SHELL", "pg_isready -U talentsphere"]
            interval: 10s
            timeout: 5s
            retries: 5

    citus-worker-1:
        image: citusdata/citus:12.1.1
        container_name: talentsphere-citus-worker-1
        environment:
            POSTGRES_USER: ${POSTGRES_USER:-talentsphere}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-securepassword}
            POSTGRES_DB: ${POSTGRES_DB:-talentsphere_db}
            PGDATA: /var/lib/postgresql/data
            CITUS_COORDINATOR_HOST: citus-coordinator
            CITUS_COORDINATOR_PORT: 5432
        volumes:
            - citus_worker_1_data:/var/lib/postgresql/data
        networks:
            - talentsphere-net
        depends_on:
            - citus-coordinator

    citus-worker-2:
        image: citusdata/citus:12.1.1
        container_name: talentsphere-citus-worker-2
        environment:
            POSTGRES_USER: ${POSTGRES_USER:-talentsphere}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-securepassword}
            POSTGRES_DB: ${POSTGRES_DB:-talentsphere_db}
            PGDATA: /var/lib/postgresql/data
            CITUS_COORDINATOR_HOST: citus-coordinator
            CITUS_COORDINATOR_PORT: 5432
        volumes:
            - citus_worker_2_data:/var/lib/postgresql/data
        networks:
            - talentsphere-net
        depends_on:
            - citus-coordinator

networks:
    talentsphere-net:
        driver: bridge

volumes:
    citus_coordinator_data:
    citus_worker_1_data:
    citus_worker_2_data:
